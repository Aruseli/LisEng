# –ê–Ω–∞–ª–∏–∑ —Ç–∞–±–ª–∏—Ü –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∏ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ —Å–∏—Å—Ç–µ–º–µ LisEng, –∞ —Ç–∞–∫–∂–µ –≤—ã—è–≤–ª—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö.

## –ù–æ–≤—ã–µ API endpoints

### `/api/ai/analyze-voice`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê–Ω–∞–ª–∏–∑ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ü–µ–ª–µ–≤—ã—Ö —Å–ª–æ–≤, –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏ –∏ –æ–±—â–µ–π –æ—Ü–µ–Ω–∫–∏.
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: `transcription`, `targetWords[]`, `level`, `userId`
- **–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∏–¥–±–µ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
  ```typescript
  {
    pronunciation: { score, feedback, issues[] },
    vocabulary: { targetWordsUsed[], missingWords[], feedback, suggestions[] },
    grammar: { errors[], feedback },
    overall: { score, feedback, suggestions[] }
  }
  ```
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `VoiceMessagesTab` –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

## –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —É—Ä–æ–∫–æ–≤ —Å –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ–º

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Ä–æ–∫–æ–≤ —Å –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ–º –≤ –æ–¥–∏–Ω –¥–µ–Ω—å:
- **–¢–∏–ø—ã —É—Ä–æ–∫–æ–≤ —Å –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ–º**:
  - `speaking` - –≤—Å–µ–≥–¥–∞ –≥–æ–ª–æ—Å–æ–≤–æ–π
  - `ai_practice` - –µ—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ/–æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç "–ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π" –∏–ª–∏ "–≥–æ–ª–æ—Å"
  - `vocabulary` - –µ—Å–ª–∏ –µ—Å—Ç—å `pronunciationScript` –∏–ª–∏ `requiresPronunciation: true`
  - –õ—é–±–æ–π —É—Ä–æ–∫ —Å —Ñ–ª–∞–≥–æ–º `requiresPronunciation: true`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤**:
  - `ensureSnapshotDrivenTasks()` - –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–¥–∞—á –∏–∑ snapshot insights
  - `ensureTasksFromStructure()` - –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–¥–∞—á –∏–∑ weekly_structure
  - `createDefaultTasks()` - –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–∞–¥–∞—á
- **–§—É–Ω–∫—Ü–∏—è**: `hasPronunciationTask(tasks: DailyTaskRecord[]): boolean` –≤ `DailyPlanService`

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è targetWords –≤ speaking –∏ ai_practice —É—Ä–æ–∫–∏

- **–ü–æ–ª—É—á–µ–Ω–∏–µ targetWords**:
  - –ò–∑ `lessonMaterials.targetWords` (–µ—Å–ª–∏ —É—Ä–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω)
  - –ò–∑ `type_specific_payload.targetWords` (–µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∑–∞–¥–∞–Ω–∏–∏)
  - –ß–µ—Ä–µ–∑ `/api/lesson/task` –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —É—Ä–æ–∫–∞
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ speaking —É—Ä–æ–∫–∞—Ö**:
  - –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ `SpeakingRolePlayTab` —Å –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤
  - –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ AI –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –º—è–≥–∫–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
  - –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `conversationData.targetWordsUsed` –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ voice messages —É—Ä–æ–∫–∞—Ö**:
  - –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ `VoiceMessagesTab` —Å –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö/–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
  - –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ `/api/ai/analyze-voice` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  - –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `voiceMessagesData.targetWordsUsed` –∏ `targetWordsMissing` –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞

---

## 1. active_recall_sessions

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–•—Ä–∞–Ω–∏—Ç —Å–µ—Å—Å–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (Active Recall) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞ SM-2 –¥–ª—è –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π:
1. **`lib/lesson/lesson-completion-service.ts:updateActiveRecall()`** (—Å—Ç—Ä–æ–∫–∏ 193-308)
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞ —Å —Ñ–ª—ç—à-–∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `next_review_date` –≤ `vocabulary_cards`

2. **`lib/lesson-snapshots/lesson-snapshot-service.ts:createActiveRecallSessions()`** (—Å—Ç—Ä–æ–∫–∏ 327-384)
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –¥–ª—è –Ω–µ–∑–Ω–∞–∫–æ–º—ã—Ö —Å–ª–æ–≤ –∏–∑ `problem_areas`
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –¥–ª—è –æ—à–∏–±–æ–∫ (grammar_rule)

3. **`lib/vocabulary/vocabulary-generation-service.ts:saveCards()`** (—Å—Ç—Ä–æ–∫–∏ 333-351)
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–ª–æ–≤–∞—Ä—è

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π:
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —á–µ—Ä–µ–∑ `updateActiveRecall()`
- –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ–ª—è: `quality`, `ease_factor`, `interval_days`, `repetitions`, `next_review_date`, `recall_success`, `recall_time_seconds`

### –°–≤—è–∑–∏
- `user_id` ‚Üí `users(id)`
- `lesson_snapshot_id` ‚Üí `lesson_snapshots(id)`
- `recall_item_id` ‚Üí `vocabulary_cards(id)` (–∫–æ–≥–¥–∞ `recall_item_type = 'vocabulary_card'`)

### –°—Ç–∞—Ç—É—Å
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è**

---

## 2. kumon_progress

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ –ö—É–º–æ–Ω –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤ (–≥—Ä–∞–º–º–∞—Ç–∏–∫–∞, –ª–µ–∫—Å–∏–∫–∞ –∏ —Ç.–¥.).

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –°–æ–∑–¥–∞–Ω–∏–µ/–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
1. **`lib/lesson-snapshots/lesson-snapshot-service.ts:updateKumonProgress()`** (—Å—Ç—Ä–æ–∫–∏ 246-322)
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ `lesson_snapshot`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç–≤–µ—Ç–æ–≤
   - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `consecutive_correct` –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞—Ö
   - –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å (1-7) –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞

### –ü—Ä–æ–±–ª–µ–º–∞
‚ö†Ô∏è **–¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ UI**

### –°–≤—è–∑–∏
- `user_id` ‚Üí `users(id)`
- `last_practiced_snapshot_id` ‚Üí `lesson_snapshots(id)`
- `session_id` ‚Üí `ai_sessions(id)`

### –°—Ç–∞—Ç—É—Å
‚ö†Ô∏è **–°–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ**

---

## 3. progress_metrics

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–•—Ä–∞–Ω–∏—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è, –≤—Ä–µ–º—è –∏–∑—É—á–µ–Ω–∏—è, –≤—ã—É—á–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
1. **`lib/lesson/lesson-completion-service.ts:completeLesson()`** (—Å—Ç—Ä–æ–∫–∏ 91-94)
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `tasks_completed` –∏ `study_minutes`
   - **–ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç `words_learned`** ‚ùå

#### –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
- **`lib/hasura-queries.ts:updateProgressMetrics()`** (—Å—Ç—Ä–æ–∫–∏ 602-660)
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `tasks_completed`, `study_minutes`, `words_learned`
   - –ù–æ `words_learned` –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ

### –ü—Ä–æ–±–ª–µ–º–∞
‚ùå **`words_learned` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑—É—á–µ–Ω–∏–∏ —Å–ª–æ–≤**

### –°–≤—è–∑–∏
- `user_id` ‚Üí `users(id)`

### –°—Ç–∞—Ç—É—Å
‚ö†Ô∏è **–ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ `tasks_completed` –∏ `study_minutes`**

---

## 4. review_history

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ò—Å—Ç–æ—Ä–∏—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –∫–∞—Ä—Ç–æ—á–µ–∫ —Å–ª–æ–≤–∞—Ä—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π:
1. **`lib/hasura-queries.ts:updateVocabularyCardReview()`** (—Å—Ç—Ä–æ–∫–∏ 273-281)
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞
‚ùå **–§—É–Ω–∫—Ü–∏—è `updateVocabularyCardReview()` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞, –Ω–æ –ù–ò–ì–î–ï –ù–ï –í–´–ó–´–í–ê–ï–¢–°–Ø**

–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- `lib/lesson/lesson-completion-service.ts:updateActiveRecall()` - –æ–±–Ω–æ–≤–ª—è–µ—Ç `active_recall_sessions`, –Ω–æ –ù–ï —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ `review_history`
- `lib/lesson/lesson-completion-service.ts:updateActiveRecall()` - –æ–±–Ω–æ–≤–ª—è–µ—Ç `vocabulary_cards.next_review_date`, –Ω–æ –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç `correct_count` –∏ `incorrect_count`

### –°–≤—è–∑–∏
- `card_id` ‚Üí `vocabulary_cards(id)`
- `user_id` ‚Üí `users(id)`

### –°—Ç–∞—Ç—É—Å
‚ùå **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - —Ñ—É–Ω–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è**

---

## 5. shu_ha_ri_progress

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ Shu-Ha-Ri (—Ç—Ä–∏ —Å—Ç–∞–¥–∏–∏ –æ–±—É—á–µ–Ω–∏—è: —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º, –ø–æ–Ω–∏–º–∞–Ω–∏–µ, —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ).

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
1. **`lib/lesson-snapshots/shu-ha-ri-service.ts:updateShuHaRiProgress()`** (—Å—Ç—Ä–æ–∫–∏ 319-369)
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –Ω–∞–≤—ã–∫–∞–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞–¥–∏–∏ (shu/ha/ri)

### –ü—Ä–æ–±–ª–µ–º–∞
‚ö†Ô∏è **–¢–∞–±–ª–∏—Ü–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ, –ø–æ—Ö–æ–∂–µ, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ UI**

### –°–≤—è–∑–∏
- `user_id` ‚Üí `users(id)`
- `skill_id` ‚Üí (—Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–∞–≤—ã–∫, –Ω–æ –Ω–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–∞–±–ª–∏—Ü—É)

### –°—Ç–∞—Ç—É—Å
‚ö†Ô∏è **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º UI)**

---

## 6. shu_ha_ri_tests

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–•—Ä–∞–Ω–∏—Ç –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ Shu-Ha-Ri.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –°–æ–∑–¥–∞–Ω–∏–µ:
1. **`lib/lesson-snapshots/shu-ha-ri-service.ts:generateWeeklyTest()`** (—Å—Ç—Ä–æ–∫–∏ 11-72)
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ AI
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
1. **`lib/lesson-snapshots/shu-ha-ri-service.ts:checkTest()`** (—Å—Ç—Ä–æ–∫–∏ 151-241)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞
‚ùå **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–π UI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

### –°–≤—è–∑–∏
- `user_id` ‚Üí `users(id)`

### –°—Ç–∞—Ç—É—Å
‚ùå **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º UI**

---

## 7. stage_progress

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —ç—Ç–∞–ø–∞–º –æ–±—É—á–µ–Ω–∏—è (stage).

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –°–æ–∑–¥–∞–Ω–∏–µ:
1. **`lib/plan/daily-plan-service.ts:getOrCreateStageProgress()`** (—Å—Ç—Ä–æ–∫–∏ 746-797)
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
1. **`lib/hasura-queries.ts:updateStageProgressFromTask()`** (—Å—Ç—Ä–æ–∫–∏ 742-782)
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `lesson-completion-service.ts:completeLesson()` (—Å—Ç—Ä–æ–∫–∞ 101)
   - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `tasks_completed` –Ω–∞ 1

2. **`lib/hasura-queries.ts:updateStageProgressStats()`** (—Å—Ç—Ä–æ–∫–∏ 554-597)
   - –§—É–Ω–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∏–≥–¥–µ –≤ –∫–æ–¥–µ

### –ü—Ä–æ–±–ª–µ–º—ã
‚ùå **`words_learned` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** - –ø–æ–ª–µ –æ—Å—Ç–∞–µ—Ç—Å—è 0, —Ö–æ—Ç—è —Å–ª–æ–≤–∞ –∏–∑—É—á–∞—é—Ç—Å—è
‚ùå **`errors_pending` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** - –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –Ω–µ–ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
‚ùå **`average_accuracy` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** - –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å

### –°–≤—è–∑–∏
- `user_id` ‚Üí `users(id)`
- `stage_id` ‚Üí `study_stages(id)`

### –°—Ç–∞—Ç—É—Å
‚ö†Ô∏è **–ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `tasks_completed`**

---

## 8. stage_tests

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–•—Ä–∞–Ω–∏—Ç —Ç–µ—Å—Ç—ã –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏ –æ–±—É—á–µ–Ω–∏—è.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
‚ùå **–¢–∞–±–ª–∏—Ü–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∏–≥–¥–µ –≤ –∫–æ–¥–µ**

### –°–≤—è–∑–∏
- `user_id` ‚Üí `users(id)`
- `stage_id` ‚Üí `study_stages(id)`

### –°—Ç–∞—Ç—É—Å
‚ùå **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**

---

## 9. streaks

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–µ—Ä–∏–∏ –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ (streak) –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
1. **`lib/hasura-queries.ts:updateStreak()`** (—Å—Ç—Ä–æ–∫–∏ 665-776)
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `lesson-completion-service.ts:completeLesson()` (—Å—Ç—Ä–æ–∫–∞ 97)
   - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—Ç—Ä–∏–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –í–°–ï –∑–∞–¥–∞–Ω–∏—è –¥–Ω—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
   - **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞:** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ —É–∂–µ –æ–±–Ω–æ–≤–ª—è–ª–∏ —Å–µ–≥–æ–¥–Ω—è
   - **–î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç Shu-Ha-Ri –Ω–∞ –∫–∞–∂–¥—ã–π 7-–π –¥–µ–Ω—å —Å—Ç—Ä–∏–∫–∞

#### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** —Å—Ç—Ä–∏–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –í–°–ï –∑–∞–¥–∞–Ω–∏—è –¥–Ω—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å—Ç—Ä–∏–∫–∞:** –µ—Å–ª–∏ –≤—á–µ—Ä–∞ –±—ã–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —Å—Ç—Ä–∏–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 1
- **–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å:** –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, —Å—Ç—Ä–∏–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 1
- **–°–±—Ä–æ—Å —Å—Ç—Ä–∏–∫–∞:** –µ—Å–ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω –¥–µ–Ω—å, —Å—Ç—Ä–∏–∫ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ 1
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:** –µ—Å–ª–∏ —É–∂–µ –æ–±–Ω–æ–≤–ª—è–ª–∏ —Å–µ–≥–æ–¥–Ω—è, —Å—Ç—Ä–∏–∫ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å shu_ha_ri_tests:
- –ù–∞ –∫–∞–∂–¥—ã–π 7-–π –¥–µ–Ω—å —Å—Ç—Ä–∏–∫–∞ (7, 14, 21, 28...) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–µ—Å—Ç Shu-Ha-Ri
- `week_start_date` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –æ—Ç —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ —Ç–µ—Å—Ç –µ—â–µ –Ω–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é —Å—Ç—Ä–∏–∫–∞

#### –ß—Ç–µ–Ω–∏–µ:
1. **`lib/hasura-queries.ts:getStreak()`** (—Å—Ç—Ä–æ–∫–∏ 325-331)
   - –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `daily-plan-service.ts` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ dashboard

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
- **`components/app/Header.tsx`** (—Å—Ç—Ä–æ–∫–∏ 58-61, 69-72)
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç `current_streak` –∏–∑ `dashboard?.plan?.streak?.current_streak`
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –∏ –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏

### –°–≤—è–∑–∏
- `user_id` ‚Üí `users(id)`
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å `shu_ha_ri_tests` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤)

### –°—Ç–∞—Ç—É—Å
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**

---

## 10. study_stages

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —ç—Ç–∞–ø—ã –æ–±—É—á–µ–Ω–∏—è (stages) —Å –∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∏ –ø–æ—Ä—è–¥–∫–æ–º.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –ß—Ç–µ–Ω–∏–µ:
1. **`lib/plan/daily-plan-service.ts:getOrCreateStageProgress()`** (—Å—Ç—Ä–æ–∫–∏ 750-777)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —ç—Ç–∞–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –°–≤—è–∑–∏
- –°–≤—è–∑–∞–Ω–∞ —Å `stage_progress` —á–µ—Ä–µ–∑ `stage_id`

### –°—Ç–∞—Ç—É—Å
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤**

---

## 11. vocabulary_cards

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–•—Ä–∞–Ω–∏—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–ª–æ–≤–∞—Ä—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –°–æ–∑–¥–∞–Ω–∏–µ:
1. **`lib/vocabulary/vocabulary-generation-service.ts:saveCards()`** (—Å—Ç—Ä–æ–∫–∏ 313-326)
   - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª–æ–≤

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
1. **`lib/lesson/lesson-completion-service.ts:updateActiveRecall()`** (—Å—Ç—Ä–æ–∫–∏ 298-306)
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `next_review_date` –∏ `last_reviewed_at`
   - **–ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç `correct_count` –∏ `incorrect_count`** ‚ùå

2. **`lib/vocabulary/vocabulary-generation-service.ts:saveCards()`** (—Å—Ç—Ä–æ–∫–∏ 293-302)
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ø—Ä–∏–º–µ—Ä—ã)

### –ü—Ä–æ–±–ª–µ–º—ã
‚ùå **`correct_count` –∏ `incorrect_count` –æ—Å—Ç–∞—é—Ç—Å—è 0** - –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
‚ùå **–§—É–Ω–∫—Ü–∏—è `updateVocabularyCardReview()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è**, —Ö–æ—Ç—è –æ–Ω–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç —ç—Ç–∏ –ø–æ–ª—è

### –°–≤—è–∑–∏
- `user_id` ‚Üí `users(id)`

### –°—Ç–∞—Ç—É—Å
‚ö†Ô∏è **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ `correct_count` –∏ `incorrect_count` –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è**

---

## 12. weekly_structure

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –æ–±—É—á–µ–Ω–∏—è (–∫–∞–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –≤ –∫–∞–∫–∏–µ –¥–Ω–∏).

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –ß—Ç–µ–Ω–∏–µ:
1. **`lib/hasura-queries.ts:getWeeklyStructure()`** (—Å—Ç—Ä–æ–∫–∏ 430-450)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `daily-plan-service.ts` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞–Ω–∏–π

2. **`lib/plan/daily-plan-service.ts:createTasksFromWeeklyStructure()`** (—Å—Ç—Ä–æ–∫–∏ 499-510)
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–µ–¥–µ–ª–∏

### –°–≤—è–∑–∏
- –°–≤—è–∑–∞–Ω–∞ —Å `daily_tasks` —á–µ—Ä–µ–∑ `type_specific_payload.weekly_structure_id`

### –°—Ç–∞—Ç—É—Å
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞**

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –°–ª–æ–≤–∞ –Ω–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –≤—ã—É—á–µ–Ω–Ω—ã–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –∏–∑—É—á–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Å–ª–æ–≤–∞—Ä—è –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `progress_metrics.words_learned`
- –ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `stage_progress.words_learned`
- –ù–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è `vocabulary_cards.correct_count` –∏ `incorrect_count`

**–ü—Ä–∏—á–∏–Ω–∞:**
- –§—É–Ω–∫—Ü–∏—è `updateVocabularyCardReview()` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞, –Ω–æ –Ω–∏–≥–¥–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- –í–º–µ—Å—Ç–æ –Ω–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `updateActiveRecall()`, –∫–æ—Ç–æ—Ä–∞—è –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ `active_recall_sessions` –∏ `next_review_date`

**–†–µ—à–µ–Ω–∏–µ:**
- –í—ã–∑—ã–≤–∞—Ç—å `updateVocabularyCardReview()` –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ `SwipeCard.tsx`
- –ò–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –≤ `updateActiveRecall()`
- –î–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `words_learned` –≤ `progress_metrics` –∏ `stage_progress` –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫

### 2. review_history –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –¢–∞–±–ª–∏—Ü–∞ `review_history` —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `updateVocabularyCardReview()`, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –í—ã–∑—ã–≤–∞—Ç—å `updateVocabularyCardReview()` –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ `review_history` –≤ `updateActiveRecall()`

### 3. stage_progress.words_learned –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ–ª–µ –æ—Å—Ç–∞–µ—Ç—Å—è 0, —Ö–æ—Ç—è —Å–ª–æ–≤–∞ –∏–∑—É—á–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `words_learned` –≤ `updateStageProgressFromTask()` –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
- –í—ã–∑—ã–≤–∞—Ç—å –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ (–∫–æ–≥–¥–∞ `wasCorrect = true`)

### 4. progress_metrics.words_learned –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ–ª–µ –æ—Å—Ç–∞–µ—Ç—Å—è 0 –∏–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `wordsLearned` –≤ `updateProgressMetrics()` –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞ —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ª–æ–≤

### 5. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã

- `stage_tests` - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- `shu_ha_ri_tests` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (–Ω–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º UI)
- `shu_ha_ri_progress` - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
- `kumon_progress` - —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ UI

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –∫–∞—Ä—Ç–æ—á–µ–∫:**
   - –í—ã–∑—ã–≤–∞—Ç—å `updateVocabularyCardReview()` –≤ `SwipeCard.tsx` –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
   - –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `correct_count`/`incorrect_count` –≤ `updateActiveRecall()`

2. **–û–±–Ω–æ–≤–ª—è—Ç—å words_learned:**
   - –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ (`wasCorrect = true`) —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å `words_learned` –≤ `progress_metrics` –∏ `stage_progress`

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å review_history:**
   - –°–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

4. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
   - –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `stage_tests` –∏ `shu_ha_ri_tests` –≤ UI
   - –õ–∏–±–æ —É–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã

5. **–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å kumon_progress:**
   - –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ö—É–º–æ–Ω –≤ UI –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–∞

---

## –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π

```
users
  ‚îú‚îÄ‚îÄ daily_tasks
  ‚îÇ     ‚îú‚îÄ‚îÄ lesson_snapshots
  ‚îÇ     ‚îÇ     ‚îú‚îÄ‚îÄ active_recall_sessions
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ vocabulary_cards
  ‚îÇ     ‚îÇ     ‚îú‚îÄ‚îÄ kumon_progress
  ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ lesson_vocabulary_extractions
  ‚îÇ     ‚îî‚îÄ‚îÄ stage_progress
  ‚îÇ           ‚îî‚îÄ‚îÄ study_stages
  ‚îú‚îÄ‚îÄ progress_metrics
  ‚îú‚îÄ‚îÄ streaks
  ‚îú‚îÄ‚îÄ vocabulary_cards
  ‚îÇ     ‚îî‚îÄ‚îÄ review_history (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
  ‚îú‚îÄ‚îÄ shu_ha_ri_progress
  ‚îú‚îÄ‚îÄ shu_ha_ri_tests (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º UI)
  ‚îî‚îÄ‚îÄ stage_tests (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```

---

## –í—ã–≤–æ–¥—ã

1. **–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–≤–∞ –Ω–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –≤—ã—É—á–µ–Ω–Ω—ã–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ:
   - `updateVocabularyCardReview()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
   - `correct_count` –∏ `incorrect_count` –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
   - `words_learned` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `progress_metrics` –∏ `stage_progress`

2. **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã:** `stage_tests`, —á–∞—Å—Ç–∏—á–Ω–æ `shu_ha_ri_tests` –∏ `shu_ha_ri_progress`

3. **–ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã:** `kumon_progress` (—Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è), `review_history` (—Ñ—É–Ω–∫—Ü–∏—è –µ—Å—Ç—å, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è)

4. **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –∫–∞—Ä—Ç–æ—á–µ–∫
   - –û–±–Ω–æ–≤–ª—è—Ç—å `words_learned` –ø—Ä–∏ –∏–∑—É—á–µ–Ω–∏–∏ —Å–ª–æ–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `review_history` –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É

---

## –ö–∞–∫ –∏ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### 13. stage_tests

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (–∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏)
–•—Ä–∞–Ω–∏—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏ –æ–±—É—á–µ–Ω–∏—è. –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–∏–∑ DB.sql):
- `test_type`: 'grammar', 'writing', 'speaking', 'comprehensive'
- `questions`: JSONB —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ —Ç–µ—Å—Ç–∞
- `user_answers`: JSONB —Å –æ—Ç–≤–µ—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `score`: 0.00 to 100.00
- `passed`: boolean
- `feedback`: JSONB —Å –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑—å—é

#### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

1. **API Route: `/app/api/stage/test/generate/route.ts`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ —ç—Ç–∞–ø–∞
   // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ stage_progress.status = 'ready_for_test'
   // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ AI –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ —ç—Ç–∞–ø–∞
   ```

2. **API Route: `/app/api/stage/test/check/route.ts`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   // –û–±–Ω–æ–≤–ª—è–µ—Ç score, passed, feedback
   // –ï—Å–ª–∏ passed = true, –æ–±–Ω–æ–≤–ª—è–µ—Ç stage_progress.status = 'test_passed'
   ```

3. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `/components/app/stage/StageTestScreen.tsx`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // UI –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ —ç—Ç–∞–ø–∞
   // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç—É
   // –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
   ```

4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Dashboard:**
   - –í —Ä–∞–∑–¥–µ–ª–µ "–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —ç—Ç–∞–ø–∞" –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–π—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç" –∫–æ–≥–¥–∞ `status = 'ready_for_test'`
   - –ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å `stage_progress.status = 'test_passed'`

#### –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å `stage_requirements` (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ `test_passed`)
- –û–±–Ω–æ–≤–ª—è–µ—Ç `stage_progress.status`

---

### 14. achievements

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (–∏–∑ DB.sql)
–•—Ä–∞–Ω–∏—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–µ–π–¥–∂–∏, –Ω–∞–≥—Ä–∞–¥—ã) –∑–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —É—Å–ø–µ—Ö–∏.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
- `type`: 'streak_7', 'words_100', 'tasks_50', 'level_up'
- `title`: –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- `description`: –æ–ø–∏—Å–∞–Ω–∏–µ
- `icon`: –∏–∫–æ–Ω–∫–∞
- `unlocked_at`: –¥–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è

#### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

1. **–°–µ—Ä–≤–∏—Å: `/lib/achievements/achievement-service.ts`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
   // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏:
   // - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ tasks_50, words_100)
   // - –û–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∏–∫–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ streak_7, streak_30)
   // - –ü–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø (level_up)
   ```

2. **API Route: `/app/api/achievements/check/route.ts`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
   // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∏–∫–∞
   ```

3. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `/components/app/progress/ProgressTab.tsx`** (—É–∂–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç achievements)
   ```typescript
   // –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   // –£–∂–µ –µ—Å—Ç—å –≤ –ø—Ä–æ–ø—Å–∞—Ö, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
   ```

4. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `/components/app/achievements/AchievementBadge.tsx`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
   // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ Header –∏–ª–∏ ProgressTab
   ```

5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
   - –í `lib/lesson/lesson-completion-service.ts:completeLesson()` –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
   - –í `lib/hasura-queries.ts:updateStreak()` –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –¥–ª—è —Å—Ç—Ä–∏–∫–∞
   - –í `hooks/useDashboardData.ts` –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `getAchievements()`

#### –¢–∏–ø—ã –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã):
- `streak_7`: 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥
- `streak_30`: 30 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥
- `words_100`: –≤—ã—É—á–µ–Ω–æ 100 —Å–ª–æ–≤
- `words_500`: –≤—ã—É—á–µ–Ω–æ 500 —Å–ª–æ–≤
- `tasks_50`: –≤—ã–ø–æ–ª–Ω–µ–Ω–æ 50 –∑–∞–¥–∞–Ω–∏–π
- `tasks_100`: –≤—ã–ø–æ–ª–Ω–µ–Ω–æ 100 –∑–∞–¥–∞–Ω–∏–π
- `level_up`: –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å

---

### 15. error_log

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (–∏–∑ DB.sql)
"–ö–Ω–∏–≥–∞ –æ—à–∏–±–æ–∫" - —Ö—Ä–∞–Ω–∏—Ç –æ—à–∏–±–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
- `category`: 'grammar', 'vocabulary', 'pronunciation', 'writing'
- `subcategory`: 'present_perfect', 'articles', 'word_order'
- `mistake`: —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
- `correction`: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
- `reviewed`: boolean - –ø–æ–≤—Ç–æ—Ä–µ–Ω–∞ –ª–∏ –æ—à–∏–±–∫–∞
- `next_review_date`: –¥–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
- `review_count`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π

#### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

1. **–°–µ—Ä–≤–∏—Å: `/lib/errors/error-log-service.ts`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ –∫–Ω–∏–≥—É –æ—à–∏–±–æ–∫
   // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–∑ lesson_snapshots.problem_areas
   // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –æ—à–∏–±–æ–∫
   ```

2. **API Route: `/app/api/errors/log/route.ts`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤ –∫–Ω–∏–≥—É –æ—à–∏–±–æ–∫
   // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞ —Å –æ—à–∏–±–∫–∞–º–∏
   ```

3. **API Route: `/app/api/errors/review/route.ts`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // –û—Ç–º–µ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∫–∞–∫ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω–æ–π
   // –û–±–Ω–æ–≤–ª—è–µ—Ç reviewed, next_review_date, review_count
   ```

4. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `/components/app/errors/ErrorBookTab.tsx`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –æ—à–∏–±–æ–∫
   // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫, —Ç—Ä–µ–±—É—é—â–∏—Ö –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
   // –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–º–µ—Ç–∏—Ç—å –æ—à–∏–±–∫—É –∫–∞–∫ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—É—é
   ```

5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
   - –í `lib/lesson-snapshots/lesson-snapshot-service.ts:extractProblemAreas()` —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å–∏ –≤ `error_log` –¥–ª—è –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ 'error'
   - –í `lib/lesson/lesson-completion-service.ts:completeLesson()` –≤—ã–∑—ã–≤–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ –∫–Ω–∏–≥—É
   - –û–±–Ω–æ–≤–ª—è—Ç—å `stage_progress.errors_pending` –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫

#### –°–≤—è–∑—å —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è `errors_reviewed` –≤ `stage_requirements`
- `stage_progress.errors_pending` –¥–æ–ª–∂–µ–Ω —Ä–∞–≤–Ω—è—Ç—å—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–µ–ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

---

### 16. kumon_progress

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (–∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏)
–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ –ö—É–º–æ–Ω (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É—Å–ª–æ–∂–Ω–µ–Ω–∏–µ, —É—Ä–æ–≤–Ω–∏ 1-7) –¥–ª—è **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤** (–≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª, —Ç–µ–º –ª–µ–∫—Å–∏–∫–∏).

#### –ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ—Ç–æ–¥–∏–∫–∞ –ö—É–º–æ–Ω?
–ú–µ—Ç–æ–¥–∏–∫–∞ –ö—É–º–æ–Ω - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞ —Å —É—Ä–æ–≤–Ω—è–º–∏ 1-7. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É—Å–ª–æ–∂–Ω–µ–Ω–∏–µ**: –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –∫ —Å–ª–æ–∂–Ω–æ–º—É
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –¥–æ –ø–æ–ª–Ω–æ–≥–æ —É—Å–≤–æ–µ–Ω–∏—è
- **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ç–µ–º–ø**: –∫–∞–∂–¥—ã–π –Ω–∞–≤—ã–∫ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- **–£—Ä–æ–≤–Ω–∏ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞**: 1 (–Ω–∞—á–∞–ª—å–Ω—ã–π) ‚Üí 7 (–º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ)

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:
- `skill_category`: –æ—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è ('grammar', 'vocabulary', 'reading', –∏ —Ç.–¥.)
- `skill_subcategory`: –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è ('present_perfect', 'articles', 'vocabulary_topic_X')
- `current_level`: —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞ (1-7)
- `target_level`: —Ü–µ–ª–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è —Å–µ—Å—Å–∏–∏
- `consecutive_correct`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ä—è–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- `accuracy_rate`: —Ç–æ—á–Ω–æ—Å—Ç—å –Ω–∞ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–≤–Ω–µ (0.00-1.00)
- `completion_time_avg`: —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)
- `status`: 'practicing' | 'ready_for_next' | 'mastered'

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–Ω–µ —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è):

**1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ –Ω–∞–≤—ã–∫–∞–º:**
- –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –Ω–∞–≤—ã–∫–∏ –∏–∑ `problem_areas` –∏ `lesson_type`
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–≤—ã–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å:
  - –ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ: `consecutive_correct++`
  - –ü—Ä–∏ 3+ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–æ–¥—Ä—è–¥: –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å (1‚Üí2‚Üí3...‚Üí7)
  - –ü—Ä–∏ –æ—à–∏–±–∫–µ: `consecutive_correct = 0`, –≤–æ–∑–º–æ–∂–µ–Ω –æ—Ç–∫–∞—Ç –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –Ω–∏–∂–µ

**2. –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π:**
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `current_level` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞–Ω–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —É—Ä–æ–≤–Ω—è 1 - –ø—Ä–æ—Å—Ç—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –¥–ª—è —É—Ä–æ–≤–Ω—è 7 - —Å–ª–æ–∂–Ω—ã–µ

**3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–∞–±—ã—Ö –º–µ—Å—Ç:**
- –ù–∞–≤—ã–∫–∏ —Å –Ω–∏–∑–∫–∏–º `current_level` –∏–ª–∏ –Ω–∏–∑–∫–æ–π `accuracy_rate` - –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏
- –ú–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö –Ω–∞–≤—ã–∫–æ–≤

**4. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è:**
- –ö–∞–∂–¥—ã–π –Ω–∞–≤—ã–∫ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ 5 –ø–æ "present_perfect", –Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ 2 –ø–æ "articles"
- –°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –±–æ–ª—å—à–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö –Ω–∞–≤—ã–∫–æ–≤

**5. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏:**
- `last_practiced_at` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞–ª—Å—è –Ω–∞–≤—ã–∫
- –ú–æ–∂–Ω–æ –≤—ã—è–≤–ª—è—Ç—å –Ω–∞–≤—ã–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞–≤–Ω–æ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª–∏—Å—å

#### –°–≤—è–∑—å —Å ProgressTab.tsx:

**ProgressTab –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- **–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å** –ø–æ –Ω–µ–¥–µ–ª—è–º (—Å–ª–æ–≤–∞, –∑–∞–¥–∞–Ω–∏—è, –º–∏–Ω—É—Ç—ã)
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —ç—Ç–∞–ø–∞** (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π, –≤—ã—É—á–µ–Ω–æ —Å–ª–æ–≤, –∏ —Ç.–¥.)
- **–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è** (–±–µ–π–¥–∂–∏ –∑–∞ –æ–±—â–∏–µ —É—Å–ø–µ—Ö–∏)

**kumon_progress –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- **–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å** –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –Ω–∞–≤—ã–∫–∞–º (–≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞, —Ç–µ–º—ã)
- **–£—Ä–æ–≤–Ω–∏ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–≤—ã–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
- **–°–ª–∞–±—ã–µ –º–µ—Å—Ç–∞** (–Ω–∞–≤—ã–∫–∏ —Å –Ω–∏–∑–∫–∏–º —É—Ä–æ–≤–Ω–µ–º)

**–≠—Ç–æ —Ä–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏:**
- `ProgressTab` = –º–∞–∫—Ä–æ-—É—Ä–æ–≤–µ–Ω—å (–æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å, —ç—Ç–∞–ø—ã)
- `kumon_progress` = –º–∏–∫—Ä–æ-—É—Ä–æ–≤–µ–Ω—å (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–∞–≤—ã–∫–∏, –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞)

#### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

**1. –ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª –≤ ProgressTab.tsx:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –Ω–∞–≤—ã–∫–∞–º" –ø–æ—Å–ª–µ "–§–æ–∫—É—Å —ç—Ç–∞–ø–∞"
<section className="rounded-3xl bg-white p-6 shadow-sm">
  <h2 className="text-lg font-semibold text-gray-900">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –Ω–∞–≤—ã–∫–∞–º (–ö—É–º–æ–Ω)</h2>
  {/* –°–ø–∏—Å–æ–∫ –Ω–∞–≤—ã–∫–æ–≤ —Å —É—Ä–æ–≤–Ω—è–º–∏, –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞–º–∏, –¥–∞—Ç–∞–º–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏ */}
</section>
```

**2. –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: `/components/app/progress/KumonSkillsList.tsx`** (—Å–æ–∑–¥–∞—Ç—å)
```typescript
// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –Ω–∞–≤—ã–∫–æ–≤ —Å:
// - –¢–µ–∫—É—â–∏–º —É—Ä–æ–≤–Ω–µ–º (1-7)
// - –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–≤–Ω—é
// - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–æ–¥—Ä—è–¥ (consecutive_correct / 3)
// - –¢–æ—á–Ω–æ—Å—Ç—å—é (accuracy_rate)
// - –î–∞—Ç–æ–π –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏
// - –°—Ç–∞—Ç—É—Å–æ–º (practicing / ready_for_next / mastered)
```

**3. API Route: `/app/api/progress/kumon/route.ts`** (—Å–æ–∑–¥–∞—Ç—å)
```typescript
// GET: –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞–≤—ã–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –Ω–∞–≤—ã–∫–æ–≤ —Å —É—Ä–æ–≤–Ω—è–º–∏, –º–µ—Ç—Ä–∏–∫–∞–º–∏, —Å—Ç–∞—Ç—É—Å–∞–º–∏
```

**4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞–Ω–∏–π:**
```typescript
// –í daily-plan-service.ts –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å kumon_progress –¥–ª—è:
// - –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞–Ω–∏–π –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö –Ω–∞–≤—ã–∫–æ–≤ (–Ω–∏–∑–∫–∏–π current_level)
// - –ê–¥–∞–ø—Ç–∞—Ü–∏–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π –ø–æ–¥ current_level
// - –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è –Ω–∞–≤—ã–∫–æ–≤ —Å–æ status='practicing'
```

**5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Dashboard:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ø-3 –Ω–∞–≤—ã–∫–∞, —Ç—Ä–µ–±—É—é—â–∏—Ö –≤–Ω–∏–º–∞–Ω–∏—è (–Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–ª–∏ –¥–∞–≤–Ω–æ –Ω–µ –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞–ª–∏—Å—å)
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞–≤—ã–∫–∏, –≥–æ—Ç–æ–≤—ã–µ –∫ –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å (status='ready_for_next')

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:

```typescript
// –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≤—ã–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è
const weakSkills = kumonProgress.filter(
  skill => skill.current_level <= 3 || 
           skill.accuracy_rate < 0.7 ||
           daysSince(skill.last_practiced_at) > 7
);

// –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≤—ã–∫–∏, –≥–æ—Ç–æ–≤—ã–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–≤–Ω—é
const readySkills = kumonProgress.filter(
  skill => skill.status === 'ready_for_next'
);

// –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö –Ω–∞–≤—ã–∫–æ–≤
const practiceTasks = weakSkills.map(skill => ({
  type: skill.skill_category,
  topic: skill.skill_subcategory,
  difficulty: skill.current_level, // –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —É—Ä–æ–≤–µ–Ω—å
}));
```

#### –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–æ–≤
- ‚úÖ –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ (3 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–æ–¥—Ä—è–¥ ‚Üí —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å)
- ‚úÖ –û—Ç–∫–∞—Ç —É—Ä–æ–≤–Ω—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤ –∏–∑ `problem_areas` –∏ `lesson_type`

#### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- ‚ùå –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI (ProgressTab –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
- ‚ùå API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
- ‚ùå –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã, –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ –Ω–∞–≤—ã–∫–∞–º)

---

### 17. shu_ha_ri_tests –∏ shu_ha_ri_progress

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (–∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏)
–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ Shu-Ha-Ri (—Ç—Ä–∏ —Å—Ç–∞–¥–∏–∏: —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º, –ø–æ–Ω–∏–º–∞–Ω–∏–µ, —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ).

#### –ú–µ—Ç–æ–¥–∏–∫–∞ Shu-Ha-Ri:
- **Shu (ÂÆà)**: –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º - —Å—Ç—Ä–æ–≥–æ–µ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª
- **Ha (Á†¥)**: –û—Ç—Ö–æ–¥ –æ—Ç —Ñ–æ—Ä–º—ã - –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å—É—Ç–∏ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö
- **Ri (Èõ¢)**: –¢—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ü–∏—è - —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –±–µ–∑ –æ–ø–æ—Ä—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–ø–æ —Å—Ç—Ä–∏–∫—É) ‚úÖ:

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –¢–µ—Å—Ç—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ **—Å—Ç—Ä–∏–∫—É** (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –¥–Ω–∏ –∑–∞–Ω—è—Ç–∏–π)
- –ù–∞ –∫–∞–∂–¥—ã–π **7-–π –¥–µ–Ω—å —Å—Ç—Ä–∏–∫–∞** (7, 14, 21, 28...) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–µ—Å—Ç
- `week_start_date` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –æ—Ç —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
- –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `lesson_snapshots` –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π —Å—Ç—Ä–∏–∫–∞

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- –í `lib/hasura-queries.ts:updateStreak()` (—Å—Ç—Ä–æ–∫–∏ 750-773) –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞:
  ```typescript
  if (newCurrentStreak > 0 && newCurrentStreak % 7 === 0) {
    // –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç Shu-Ha-Ri
    await shuHaRiService.generateWeeklyTest(userId, weekStartDate, 'comprehensive');
  }
  ```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –ø–æ —Å—Ç—Ä–∏–∫—É:**
1. ‚úÖ **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å**: —Ç–µ—Å—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ä–µ–∞–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –∞ –Ω–µ –∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—é
2. ‚úÖ **–ú–æ—Ç–∏–≤–∞—Ü–∏—è**: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ç–∏–º—É–ª –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å—Ç—Ä–∏–∫
3. ‚úÖ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è**: —Ç–µ—Å—Ç –≤—ã–¥–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–Ω–∏–º–∞–ª—Å—è –Ω–µ–¥–µ–ª—é
4. ‚úÖ **–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å**: –µ—Å–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª –¥–Ω–∏, —Ç–µ—Å—Ç –Ω–µ –≤—ã–¥–∞–µ—Ç—Å—è "–≤–ø—É—Å—Ç—É—é"

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 7-–≥–æ –¥–Ω—è —Å—Ç—Ä–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–µ—Å—Ç
- `week_start_date` = —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –º–∏–Ω—É—Å 6 –¥–Ω–µ–π (7 –¥–Ω–µ–π –≤–∫–ª—é—á–∞—è —Å–µ–≥–æ–¥–Ω—è)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ —Ç–µ—Å—Ç –µ—â–µ –Ω–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é —Å—Ç—Ä–∏–∫–∞
- –ï—Å–ª–∏ —Ç–µ—Å—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ–≤—ã–π –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

#### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

**1. ‚úÖ –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `updateStreak()`:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∞ –Ω–∞ 7-–π –¥–µ–Ω—å —Å—Ç—Ä–∏–∫–∞
   - –†–∞—Å—á–µ—Ç `week_start_date` –æ—Ç —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã (7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–µ—Å—Ç–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º

2. **API Route: `/app/api/shu-ha-ri/test/generate/route.ts`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∞ –≤—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   // –ú–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
   // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ShuHaRiService.generateWeeklyTest()
   ```

3. **API Route: `/app/api/shu-ha-ri/test/check/route.ts`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–∞
   // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ShuHaRiService.checkTest()
   ```

4. **API Route: `/app/api/shu-ha-ri/test/available/route.ts`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–∞
   // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–∞ (7-–π –¥–µ–Ω—å —Å—Ç—Ä–∏–∫–∞)
   // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å: "–°–ª–µ–¥—É—é—â–∏–π —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ X –¥–Ω–µ–π —Å—Ç—Ä–∏–∫–∞"
   ```

5. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `/components/app/shu-ha-ri/WeeklyTestScreen.tsx`** (—Å–æ–∑–¥–∞—Ç—å)
   ```typescript
   // UI –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
   // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:
   // - –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 7-–≥–æ –¥–Ω—è —Å—Ç—Ä–∏–∫–∞ (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ)
   // - –ü–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Dashboard/ProgressTab
   ```

6. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Dashboard:**
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! 7 –¥–Ω–µ–π —Å—Ç—Ä–∏–∫–∞! –ü—Ä–æ–π–¥–∏ —Ç–µ—Å—Ç Shu-Ha-Ri"
   - –†–∞–∑–¥–µ–ª "–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç" —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–ª–µ–¥—É—é—â–µ–º —Ç–µ—Å—Ç–µ
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å: "–°–ª–µ–¥—É—é—â–∏–π —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ X –¥–Ω–µ–π —Å—Ç—Ä–∏–∫–∞" (7 - (current_streak % 7))

#### –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- ‚úÖ –°–µ—Ä–≤–∏—Å `lib/lesson-snapshots/shu-ha-ri-service.ts` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –ª–æ–≥–∏–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –ú–µ—Ç–æ–¥ `shouldCreateWeeklyTest()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —Ç–µ—Å—Ç–∞
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `shu_ha_ri_progress` –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
- ‚úÖ **–°–≤—è–∑—å —Å–æ —Å—Ç—Ä–∏–∫–∞–º–∏ –≤ `updateStreak()`** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ 7-–π –¥–µ–Ω—å —Å—Ç—Ä–∏–∫–∞
- ‚úÖ **–†–∞—Å—á–µ—Ç `week_start_date` –æ—Ç —Å—Ç—Ä–∏–∫–∞** - 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –æ—Ç —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã

#### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- ‚ùå UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
- ‚ùå API routes –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ—Å—Ç–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- ‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–∞ (7-–π –¥–µ–Ω—å —Å—Ç—Ä–∏–∫–∞) –≤ Dashboard
- ‚ùå –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞ (7 - (current_streak % 7))

---

### 18. stage_requirements

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (–∏–∑ DB.sql)
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
- `requirement_type`: 'tasks_completed', 'words_learned', 'errors_reviewed', 'accuracy_threshold', 'test_passed'
- `requirement_value`: —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è tasks_completed, words_learned)
- `requirement_threshold`: –ø–æ—Ä–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è accuracy_threshold, test_passed)

#### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

1. **–£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
   - `lib/stage-progression.ts:StageProgressionService.checkStageRequirements()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
   - `lib/hasura-queries.ts:getStageRequirements()` - –ø–æ–ª—É—á–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
   - `app/api/plan/requirement-checks/route.ts` - API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

2. **–ì–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:**
   - `components/app/dashboard/DashboardTab.tsx` - —Ä–∞–∑–¥–µ–ª "–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —ç—Ç–∞–ø–∞"
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `StageProgressionService` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

#### –°—Ç–∞—Ç—É—Å:
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `stage_progress.words_learned` - –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è `words_learned`
- `stage_progress.errors_pending` - –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è `errors_reviewed`
- `stage_progress.average_accuracy` - –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è `accuracy_threshold`
- `stage_progress.status` - –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è `test_passed`

---

## –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ç–∞–±–ª–∏—Ü

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–∫—Ä–∏—Ç–∏—á–Ω–æ):
1. **error_log** - –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è `errors_reviewed`
2. **stage_tests** - –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —ç—Ç–∞–ø–∞
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ words_learned** - –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è `words_learned`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–≤–∞–∂–Ω–æ):
4. **achievements** - –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. **review_history** - –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –∫–∞—Ä—Ç–æ—á–µ–∫

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
6. **kumon_progress** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI
7. **shu_ha_ri_tests** - –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

